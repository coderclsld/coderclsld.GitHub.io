## 视频压缩调用服务

ffmpeg视频压缩

[视频压缩处理之ffmpeg用法_落子无悔!的博客-CSDN博客](https://blog.csdn.net/qq_32460819/article/details/106773987)


ffmpeg crf以及各参数解析

[FFmpeg学习（11）——视频转码之-crf参数详解_秦岭熊猫的博客-CSDN博客_crf参数](https://blog.csdn.net/tianshan2010/article/details/104837422)

[FFmpeg学习(知乎)](https://zhuanlan.zhihu.com/p/557464664)

### 添加url任务

地址：http://10.8.8.91:9091/addTaskDownloadVideoByUrl

方式：POST

#### 参数

| 参数         | 含  义   | 备注                           |
| ------------ | -------- | ------------------------------ |
| url          | 截图链接 | 用于抓取的视频链接地址         |
| redirect_url | 回调地址 | 用户自定义用于接收任务执行结果 |
| type         | 任务类型 | 值为1,2,3，详情看下表          |

#### type类型

| 值   | 含义                                                         |
| ---- | ------------------------------------------------------------ |
| 1    | 任务抓取视频链接，对视频进行第一帧截图，返回视频截图地址     |
| 2    | 任务抓取视频链接，对视频进行第一帧截图、对视频压缩后上传dfs，返回视频截图地址和视频压缩后地址 |
| 3    | 任务抓取视频链接，对视频进行第一帧截图、对视频压缩后直接更新dfs，覆盖原先视频链接(只适用于公司dfs域名链接开头的文件资源) |

#### 返回示例

```json
{
    "code": 200,
    "msg": "任务添加成功",
    "result": {
        "TaskId": 111,
        "OrderId": 0,
        "Business": "",
        "Url": "http://down1.testing.guopan.cn/strategy/20221111/3d56c8658fde1e2e5aac1f1da024caa8.mp4",
        "RedirectUrl": "",
        "Type": 0,
        "DownloadUrl": "",
        "ScreenUrl": "",
        "ImageUrl": "",
        "CompressUrl": "",
        "VideoUrl": "",
        "Status": 0
    }
}
```

#### 返回码







### 添加file任务



### 上传url返回截图地址



### 上传file返回截图地址



### 上传url压缩视频



### 上传file压缩视频































### 视频上传压缩服务



#### 查詢文件状态
地址：http://10.8.8.91:9091/CheckChunk
方式：POST

##### 参数：

| 参数 | 含义         |
| ---- | ------------ |
| hash | 该文件hash值 |

##### 返回参数：





##### 返回码：

| code值 | 含义                                                   |
| ------ | ------------------------------------------------------ |
| 400    | 查询错误，错误信息有（获取hash路径有误、文件读取错误） |
| 200    | 服务器上不存在该文件                                   |
| 201    | 文件已存在该服务器上                                   |
| 202    | 文件分片有部分未上传                                   |







#### 上传分片

地址：http://10.8.8.91:9091/UploadChunk

方式：POST

##### 参数：

| 参数  | 含义         |
| ----- | ------------ |
| hash  | 原文件hash值 |
| index | 分片数组下标 |
| file  | 文件         |

##### 返回码：

| code值 | 含义                                                         |
| ------ | ------------------------------------------------------------ |
| 400    | 上传错误，错误信息有（获取video文件失败、获取hash文件路径错误、创建文件夹失败、文件创建失败、文件写入失败） |
| 200    | 文件分片上传成功                                             |







#### 合并文件


地址：http://10.8.8.91:9091/MergeChunk

方式：POST

##### 参数：

| 参数 | 含义         |
| ---- | ------------ |
| hash | 原文件hash值 |

##### 返回码：

| code值 | 含义                                                         |
| ------ | ------------------------------------------------------------ |
| 400    | 合并错误，错误信息有（获取hash路径文件错误、文件目录不存在、合并文件读取失败、创建文件失败、文件打开错误、文件写入错误） |
| 200    | 视频压缩成功                                                 |
| 403    | 视频截图失败                                                 |
| 404    | 截图上传DFS失败                                              |
| 405    | 视频压缩失败                                                 |
| 406    | 视频上传失败                                                 |
